Comprehensive Guide for Replit Deployment: Quad-Agent Image Studio
This document outlines the architecture, model usage, and core logic of the Quad-Agent Image Studio, with a specific focus on its text-rendering capabilities and the necessary environment configuration for Replit.
1. How the App is Designed to Avoid Spelling Mistakes (The Core Logic)
The application does not rely on a single prompt or model. It uses a sophisticated, multi-stage "text-aware" system to ensure the highest possible text accuracy. This is a critical point: if this system isn't running with the correct permissions, it will default to a lower-quality path, resulting in the errors you're seeing.
The system works in three main ways:
Automatic Model Upgrading: The application is programmed to automatically switch to more powerful models when it detects text in a prompt.
For Drafts: Normally, drafts use a fast model (gemini-2.5-flash-image). However, if the analysis detects text, it automatically upgrades to use the much more powerful gemini-3-pro-image-preview model, which has superior text-rendering capabilities.
For Final Images: The system's primary choice is imagen-4.0-generate-001, Google's state-of-the-art image model with the best text accuracy. If that model fails, the fallback is also gemini-3-pro-image-preview for any prompt containing text. A basic model is never used for a final image with text.
Strict Prompt Engineering: The "Style Architect" agent constructs a final prompt with a non-negotiable command for the image model. The instruction is structured as:
"The image MUST include the text, spelled exactly as shown: '[Your Text Here]'."
For complex words, it adds further emphasis like: "...CRITICAL SPELLING: Pay close attention to the following word and render it exactly: 'Epistemological'..."
AI Curation with OCR Validation (When Enabled): For the highest reliability, the "AI Curation" feature generates a large batch of images (e.g., 8 candidates) and then uses a "Text Integrity Agent" to perform OCR on each one. It scores them based on spelling accuracy and selects the one that is both aesthetically pleasing and correctly spelled.
Conclusion: The app's ability to avoid spelling errors is fundamentally tied to its ability to access the premium, high-quality models (imagen-4.0 and gemini-3-pro-image-preview).
2. Model Usage and Connections (The "Agents")
The application uses a "multi-agent" system where different models are used for specific tasks. Here is the complete breakdown:
A. Text & Logic Models (The "Brains")
gemini-flash-lite-latest (The Analyst)
Role: Used for fast, efficient analysis tasks that don't require heavy creative lifting.
Connections:
Initial Analysis: In performInitialAnalysis, it performs the initial breakdown of your prompt (subject, mood, etc.) and runs the "Text SFX Artist" logic to detect text instructions.
AI Curation: In scoreImageQuality, it acts as the "Quality Analyst," scoring candidate images based on composition, detail, and lighting.
gemini-3-pro-preview (The Art Director)
Role: The primary creative "brain" of the application. It has a very large context window and powerful reasoning.
Connections:
Style Architect: In enhanceStyle, it takes the initial analysis and your prompt, consults the extensive "Cinematic DNA" knowledge base, and writes the final, detailed, professional master prompt.
Image Analysis (Remix): In analyzeImage, it "reverse-engineers" a prompt from an uploaded image.
gemini-2.5-flash-native-audio-preview-09-2025 (The Transcriber)
Role: Powers the real-time "Live Brainstorming" voice feature.
Connection: Handles live audio streaming and transcription.
B. Image Generation Models (The "Artists")
imagen-4.0-generate-001 (The Master Artist)
Role: The primary, first-choice model for all final, high-quality image generations that do not use a reference image. It has the best text-to-image and text-rendering capabilities.
gemini-3-pro-image-preview (The Versatile Artist)
Role: A powerful, multi-purpose model used for demanding image tasks.
Connections:
High-Quality Fallback: If imagen-4.0 fails, this model is the fallback for all high-quality generations.
Drafts with Text: Used to generate drafts when text is required, ensuring high accuracy early on.
Image Editing: Used for all iterative edits where you provide a reference image.
gemini-2.5-flash-image (The Sketch Artist)
Role: Optimized for speed.
Connection: Used to generate the initial four "draft" images when no text is required.
3. Why It Is Failing on Replit: The Root Cause
The problem is not with the code's logic, but with the permissions of the API key being used in the Replit environment.
Premium Models Require Billing: The key models for high-quality text (imagen-4.0-generate-001 and gemini-3-pro-image-preview) require an API key from a Google AI project that has billing enabled. They are not available on the free tier.
The Error Cascade on Replit:
You enter a prompt with text.
The app's logic correctly decides to use imagen-4.0 for the final image.
It sends the request, but because your API key in Replit Secrets is likely a free-tier key, the Google API returns a PERMISSION_DENIED error.
The app is designed to be resilient. It catches this error and, to avoid crashing, falls back to gemini-3-pro-image-preview.
This model also requires a paid key, so it also returns a PERMISSION_DENIED error.
After all high-quality options are exhausted, the fallback logic eventually downgrades the request to a model that will work with a free key: gemini-2.5-flash-image.
gemini-2.5-flash-image is not designed for high-fidelity text rendering, which is why you are seeing garbled text and spelling errors.
In short, your Replit environment is forcing the app down its lowest-quality fallback path because the provided API key does not have the necessary permissions.
4. The Solution: How to Configure Replit Correctly
No code changes are needed. You must configure the Replit environment with a billing-enabled API key.
Step-by-Step Instructions:
Obtain a Billing-Enabled API Key:
Go to the Google AI Studio or your Google Cloud Platform console.
Create a new project or use an existing one.
Crucially, ensure you have enabled billing for this project. This usually involves linking a credit card.
Generate a new API key from this billing-enabled project. For guidance, see the official documentation: Google AI Billing.
Add the Key to Replit Secrets:
In your Replit project, go to the "Secrets" tab (the lock icon on the left sidebar).
Create a new secret with the following details:
Key: API_KEY
Value: Paste your full, billing-enabled API key here.
Click "Add new secret."
How the Code Reads the Secret:
The Vite configuration for this Replit project is set up to read "Secrets." The code in src/services/geminiService.ts uses process.env.API_KEY to access it. Replit automatically makes your secret available through this variable.
Restart and Rerun:
Stop the application in Replit if it is running.
Click the "Run" button to restart the server.
Once you have a valid, billing-enabled API key in your Replit Secrets, the application will have the correct permissions. It will successfully call imagen-4.0 and gemini-3-pro-image-preview, and your text rendering issues and generation failures will be resolved.